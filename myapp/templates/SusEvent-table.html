{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>

  <!--style-->
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <!--fonts-->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">
  <link rel="icon" href="img/tab_logo.png">
  <!----->

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.84.0">

    <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/sidebars/">



    <!-- Bootstrap core CSS -->
    <link href="/docs/5.0/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- Favicons -->
    <link rel="apple-touch-icon" href="/docs/5.0/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" href="/docs/5.0/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="/docs/5.0/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
    <link rel="manifest" href="/docs/5.0/assets/img/favicons/manifest.json">
    <link rel="mask-icon" href="/docs/5.0/assets/img/favicons/safari-pinned-tab.svg" color="#7952b3">
    <link rel="icon" href="/docs/5.0/assets/img/favicons/favicon.ico">
    <meta name="theme-color" content="#7952b3">


    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }

      html,
      body {
        height: 100%;
        margin: 0;
      }

      .full-height {
        height: 100%;
      }

      .nav-bg {
        background-color: rgb(141, 172, 166);
      }

      .navbar-bg {
        background-color: rgb(197, 97, 97);
      }

      .font-nav {
        font-family: 'Prompt', sans-serif;
        font-size: 20px;
      }

      .font-log {
        font-family: 'Prompt', sans-serif;
        font-size: 18px;
      }

      .icon-bar {
        width: 25px;
        height: 25px;
      }

      .menu-bar {
        width: 30px;
        height: 30px;
      }

      .list-hov a:hover {
        background-color: rgb(141, 172, 166);
      }
    </style>


    <!-- Custom styles for this template -->
    <link href="sidebars.css" rel="stylesheet">
  </head>
  <title>Computer vision for restaurant | Menu</title>
</head>

<body class="full-height">


  <!-- Image and text -->
  <nav class="navbar navbar-bg py-4">
    <a class="navbar-brand mx-3" href="menu">
      <div class="font-nav">
        <img src="{% static 'img/eye1.png' %}" width="30" height="30" class="d-inline-block align-top" alt="">
        <b>Computer vision for restaurant</b>
      </div>
    </a>
    <div class="mx-3">
      <a href="login" class="font-log op-butt align-top">
        <b>Logout</b>
      </a>
      <b style="color: white;">|</b>
      <b style="color: white;">Firstname Surname</b>
      <!--<img class="rounded-circle" width="30" height="30" alt="" src="img/bl-pic.webp" />-->
    </div>
  </nav>

  <div class="container-fluid full-height">
    <div class="row full-height">
      <div class="col-md-3 bg-light full-height">
        <div class="d-flex flex-column py-3 full-height">
          <a href="{% url 'menu' %}"
            class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-dark text-decoration-none">
            <img src="{% static 'img/menu.png' %}" class="menu-bar me-2" alt="">
            <span class="fs-4 align-items-center"><b>Menu</b></span>
          </a>
          <hr>
          <ul class="nav nav-pills flex-column mb-auto">
            <li class="list-hov">
              <a href="/menu/CustTable/" class="nav-link link-dark py-3" style="width: 100%; height: 100%;">
                <img src="/static/img/dinner2.png" class="icon-bar" alt="">
                Customers Events
              </a>
            </li>
            <li class="nav-item list-butt">
              <a href="#" class="nav-link link-dark py-3" style="width: 100%; height: 100%;">
                <img src="/static/img/loupe1.png" class="icon-bar me-2" alt="">
                Suspicious Events
              </a>
            </li>
            <li class="list-hov">
              <a href="/menu/ResTable/" class="nav-link link-dark py-3" style="width: 100%; height: 100%;">
                <img src="/static/img/check1.png" class="icon-bar me-2" alt="">
                Resolved Events
              </a>
            </li>
            <li class="list-hov">
              <a href="/menu/ListTable/" class="nav-link link-dark py-3" style="width: 100%; height: 100%;">
                <img src="/static/img/id1.png" class="icon-bar me-2" alt="">
                List of employees
              </a>
            </li>
            </li>
            <li class="list-hov">
              <a href="/menu/Dashboard" class="nav-link link-dark py-3" style="width: 100%; height: 100%;">
                <img src="/static/img/graph1.png" class="icon-bar me-2" alt="">
                Dashboard
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div class="col-md-9 full-height">
        <div class="card align-items-center mt-3" style="width: 100%; height: 100%;">
          <div class="card-body text-center" style="height: 100%; width:100%;">
            <div style="max-height: 100%; overflow-y: auto;">
              <table class="table table-hover text-nowrap mx-3 text-center" style="width: 100%;">
                <thead>
                  <tr>
                    <th scope="col" style="width: 10%">Event number</th>
                    <th scope="col" style="width: 15%">Type</th>
                    <th scope="col" style="width: 15%">Place</th>
                    <th scope="col" style="width: 20%">Date/Time</th>
                    <th scope="col" style="width: 10%">Employee ID</th>
                    <th scope="col" style="width: 15%">Video</th>
                    <th scope="col" style="width: 15%">Resolve</th>
                  </tr>
                </thead>
                <tbody>
                  {% for event in suspicious_events %}
                  {% if event.sus_status != 0 %}
                  <tr>
                    <td>{{ event.sus_id }}</td>
                    <td>{% if event.sus_type == 1 %}Employee{% else %}Drawer{% endif %}</td>
                    <td>{% if event.sus_type == 0 %}Cashier{% else %}Table no. {{ event.sus_where }}{% endif %}</td>
                    <td>{{ event.sus_datetime|date:"F j, Y g:i A" }}</td>
                    <td>{{ event.sus_employeeid }}</td>
                    <td>
                      <!-- Button trigger modal -->
                      <button type="button"
                        style="border-radius: 50px; background-color: rgb(141, 172, 166); border-color: rgb(141, 172, 166);"
                        class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#exampleModal{{ event.sus_id }}">
                        Video <img src="{% static 'img/vdo.png' %}" class="icon-bar mb-1" alt="">
                      </button>
                      <!-- Modal -->
                      <div class="modal fade" id="exampleModal{{ event.sus_id }}" tabindex="-1"
                        aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                          <div class="modal-content" style="width: 700px;">
                            <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel">Event number {{ event.sus_id }}</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                              {% if event.sus_video %}
                              <video width="400" controls style="width: 650px; height: 350px;">
                                <source src="{{ event.sus_video }}" type="video/mp4">
                                Your browser does not support HTML video.
                              </video>
                              {% else %}
                              <p>No captured video available.</p>
                              {% endif %}
                            </div>
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <button type="button" onclick="confirmResolve({{ event.sus_id }})"
                        style="border-radius: 50px; background-color: rgb(197, 97, 97); border-color: rgb(197, 97, 97);"
                        class="btn btn-dark">
                        Resolve
                      </button>
                    </td>
                  </tr>
                  {% endif %}
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script>
      function resolveEvent(sus_id) {
        fetch(`/resolve_suspicious_event/${sus_id}/`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
          }
        })
          .then(response => {
            if (response.ok) {
              // Reload the page after resolving the event
              location.reload();
            } else {
              console.error('Failed to resolve the suspicious event.');
            }
          })
          .catch(error => {
            console.error('Error:', error);
          });
      }
    </script>
    <script>
      function confirmResolve(sus_id) {
        if (confirm("Are you sure you want to resolve this event?")) {
          resolveEvent(sus_id);
        }
      }

      function resolveEvent(sus_id) {
        fetch(`/resolve_suspicious_event/${sus_id}/`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
          }
        })
          .then(response => {
            if (response.ok) {
              // Reload the page after resolving the event
              location.reload();
            } else {
              console.error('Failed to resolve the suspicious event.');
            }
          })
          .catch(error => {
            console.error('Error:', error);
          });
      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"></script>
  </div>
</body>

</html>